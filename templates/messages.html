{% extends 'base_no_search.html' %}
{% block title %}æ¶ˆæ¯ - CRAZYBLOG{% endblock %}

{% block content %}
<div class="social-page">
  {% include 'bottom_nav.html' %}

  <div class="social-header">
    <h2 class="social-title">ğŸ’¬ æœ€è¿‘æ¶ˆæ¯</h2>
  </div>

  {% if conversations %}
  <div class="conversation-list">
    {% for conv in conversations %}
    <a href="{{ url_for('chat', friend_id=conv.friend.id) }}" class="conv-item">
      {# â”€â”€ å¤´åƒå®¹å™¨ï¼šä½¿ç”¨ç‹¬ç«‹åŒ…è£¹å±‚ï¼Œè®©è§’æ ‡å¯ä»¥æº¢å‡º â”€â”€ #}
      <div class="conv-avatar-wrap">
        <div class="conv-avatar">
          {% if conv.friend.avatar_path %}
          <img src="/static/{{ conv.friend.avatar_path }}" alt="å¤´åƒ" loading="lazy">
          {% else %}
          <span>{{ conv.friend.username[0] }}</span>
          {% endif %}
        </div>
        {% if conv.unread_count > 0 %}
        <span class="conv-badge">{{ conv.unread_count if conv.unread_count < 100 else '99+' }}</span>
        {% endif %}
      </div>

      <div class="conv-body">
        <div class="conv-top">
          <span class="conv-name">{{ conv.friend.username }}</span>
          {% if conv.last_msg %}
          <span class="conv-time">{{ conv.last_msg.created_at.strftime('%m-%d %H:%M') }}</span>
          {% endif %}
        </div>
        <div class="conv-preview">
          {% if conv.last_msg %}
            {% if conv.last_msg.forwarded_post_id %}
            <span>ğŸ” è½¬å‘äº†ä¸€ç¯‡åšå®¢</span>
            {% elif conv.last_msg.image_path %}
            <span>ğŸ–¼ï¸ å›¾ç‰‡</span>
            {% else %}
            <span>{{ conv.last_msg.content[:40] }}</span>
            {% endif %}
          {% else %}
          <span style="color:#ccc">è¿˜æ²¡æœ‰æ¶ˆæ¯ï¼Œå¿«æ‰“ä¸ªæ‹›å‘¼å§~</span>
          {% endif %}
        </div>
      </div>
    </a>
    {% endfor %}
  </div>
  {% else %}
  <div class="empty-state">
    <div class="empty-icon">ğŸ’Œ</div>
    <p>è¿˜æ²¡æœ‰æ¶ˆæ¯</p>
    <p class="empty-sub">å»<a href="{{ url_for('contacts') }}">è”ç³»äºº</a>æ‰¾å¥½å‹èŠå¤©å§~</p>
  </div>
  {% endif %}
</div>

<style>
.social-page {
  padding-bottom: 80px;
}

.social-header {
  text-align: center;
  margin-bottom: 20px;
}

.social-title {
  font-size: 1.6rem;
  background: linear-gradient(135deg, #ff9eb5, #ffb6c1);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

/* ä¼šè¯åˆ—è¡¨ */
.conversation-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
}
@media (max-width: 768px) {
    .main-content {
        margin-top: 70px !important;
    }
    
    .social-page {
        padding-top: 0;
    }
}
@media (max-width: 768px) {
  /* åŸæœ‰çš„å…¶ä»–æ ·å¼ä¿æŒä¸å˜ */
  
  /* æ–°å¢ï¼šèŠå¤©æ¡†å®¹å™¨ç¼©å° */
  .chat-container {
    max-width: 95%;
    margin: 0 auto;
    padding: 10px;
  }
  
  /* æ–°å¢ï¼šæ¶ˆæ¯æ°”æ³¡ç¼©å° */
  .message-bubble {
    max-width: 85%;
    font-size: 0.85rem;
    padding: 8px 12px;
  }
  
  /* æ–°å¢ï¼šè¾“å…¥åŒºåŸŸç¼©å° */
  .chat-input-area {
    padding: 8px;
    gap: 8px;
  }
  
  .chat-input-area input {
    font-size: 0.85rem;
    padding: 10px 12px;
  }
  
  .chat-input-area button {
    padding: 8px 16px;
    font-size: 0.85rem;
  }
}

@media (max-width: 480px) {
  /* åŸæœ‰çš„å…¶ä»–æ ·å¼ä¿æŒä¸å˜ */
  
  /* æ–°å¢ï¼šæ›´å°å±å¹•è¿›ä¸€æ­¥ç¼©å° */
  .message-bubble {
    max-width: 90%;
    font-size: 0.8rem;
    padding: 6px 10px;
  }
  
  .chat-input-area input {
    font-size: 0.8rem;
    padding: 8px 10px;
  }
  
  .chat-input-area button {
    padding: 6px 12px;
    font-size: 0.8rem;
  }
  
  /* æ–°å¢ï¼šæ¶ˆæ¯æ—¶é—´æˆ³ç¼©å° */
  .message-time {
    font-size: 0.65rem;
  }
}
@media (max-width: 768px) {
  /* åŸæœ‰çš„å…¶ä»–æ ·å¼ä¿æŒä¸å˜ */
  
  /* æ–°å¢ï¼šèŠå¤©æ¡†æ•´ä½“é«˜åº¦ç¼©å° */
  .chat-messages {
    max-height: 70vh !important;  /* å¼ºåˆ¶è®¾ç½®æœ€å¤§é«˜åº¦ä¸ºè§†çª—é«˜åº¦çš„50% */
    min-height: 500x;  /* è®¾ç½®æœ€å°é«˜åº¦ä¿è¯å¯ç”¨æ€§ */
  }
}

@media (max-width: 480px) {
  /* åŸæœ‰çš„å…¶ä»–æ ·å¼ä¿æŒä¸å˜ */
  
  /* æ–°å¢ï¼šæ›´å°å±å¹•è¿›ä¸€æ­¥ç¼©å°é«˜åº¦ */
  .chat-messages {
    max-height: 45vh !important;  /* ç¼©å°åˆ°è§†çª—é«˜åº¦çš„45% */
    min-height: 250px;  /* é€‚å½“å‡å°æœ€å°é«˜åº¦ */
  }
  
  /* å¯é€‰ï¼šè®©æ•´ä¸ªèŠå¤©æ¡†å®¹å™¨ä¹Ÿæ›´ç´§å‡‘ */
  .chat-container {
    padding-top: 5px;
    padding-bottom: 5px;
  }
  
  /* å¯é€‰ï¼šå‡å°‘æ¶ˆæ¯ä¹‹é—´çš„é—´è· */
  .message-item {
    margin: 6px 0;
  }
}
/* ä¼šè¯é¡¹ */
.conv-item {
  display: flex;
  align-items: center;
  gap: 14px;
  padding: 14px 16px;
  background: transparent;
  border-radius: 16px;
  text-decoration: none;
  color: white;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
  z-index: 1;
}

.conv-item::before {
  content: '';
  position: absolute;
  inset: 0;
  z-index: -1;
  backdrop-filter: blur(10px) saturate(150%);
  -webkit-backdrop-filter: blur(10px) saturate(150%);
  background: rgba(255, 255, 255, 0.15);
  border-radius: inherit;
  transition: all 0.3s ease;
  border: 1px solid rgba(255, 255, 255, 0.2);
}

.conv-item:hover {
  transform: translateX(4px);
}

.conv-item:hover::before {
  background: rgba(255, 255, 255, 0.2);
  backdrop-filter: blur(12px) saturate(160%);
  -webkit-backdrop-filter: blur(12px) saturate(160%);
  border-color: rgba(255, 255, 255, 0.3);
}

/* â”€â”€ å¤´åƒåŒ…è£¹å±‚ï¼šä¸è£å‰ªï¼Œè®©è§’æ ‡è‡ªç”±æ‚¬æµ® â”€â”€ */
.conv-avatar-wrap {
  position: relative;
  width: 52px;
  height: 52px;
  flex-shrink: 0;
}

/* å¤´åƒæœ¬ä½“ï¼šåœ†å½¢è£å‰ªåªä½œç”¨äºå›¾ç‰‡ */
.conv-avatar {
  width: 52px;
  height: 52px;
  border-radius: 50%;
  overflow: hidden;           /* overflow:hidden é™åˆ¶åœ¨æ­¤å±‚ï¼Œä¸å½±å“è§’æ ‡ */
  background: linear-gradient(135deg, #ffb6c1, #ff9eb5);
  display: flex;
  align-items: center;
  justify-content: center;
  border: 2px solid rgba(255, 255, 255, 0.3);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.conv-avatar img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.conv-avatar span {
  color: white;
  font-weight: bold;
  font-size: 1.2rem;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

/* â”€â”€ æœªè¯»è§’æ ‡ï¼šæ‚¬æµ®åœ¨åŒ…è£¹å±‚å³ä¸Šè§’ï¼Œä¸å— overflow:hidden å½±å“ â”€â”€ */
.conv-badge {
  position: absolute;
  top: -5px;
  right: -8px;
  background: linear-gradient(135deg, #ff4d6d, #ff8fab);
  color: white;
  border-radius: 12px;
  font-size: 0.7rem;
  font-weight: 600;
  padding: 3px 8px;
  min-width: 20px;
  text-align: center;
  line-height: 1.3;
  border: 2px solid rgba(255, 255, 255, 0.4);
  box-shadow: 0 2px 8px rgba(255, 77, 109, 0.5);
  animation: pulse 2s infinite;
  z-index: 10;
  white-space: nowrap;
}

@keyframes pulse {
  0%   { transform: scale(1); }
  50%  { transform: scale(1.08); }
  100% { transform: scale(1); }
}

/* ä¼šè¯ä¸»ä½“ */
.conv-body {
  flex: 1;
  min-width: 0;
}

.conv-top {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 6px;
}

.conv-name {
  font-weight: 600;
  color: white;
  font-size: 1rem;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}

.conv-time {
  font-size: 0.75rem;
  color: rgba(255, 255, 255, 0.7);
  background: rgba(255, 255, 255, 0.1);
  padding: 3px 8px;
  border-radius: 12px;
  backdrop-filter: blur(5px);
  -webkit-backdrop-filter: blur(5px);
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.conv-preview {
  font-size: 0.85rem;
  color: rgba(255, 255, 255, 0.8);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  display: flex;
  align-items: center;
  gap: 4px;
}

.conv-preview span {
  background: rgba(255, 255, 255, 0.1);
  padding: 3px 10px;
  border-radius: 15px;
  backdrop-filter: blur(5px);
  -webkit-backdrop-filter: blur(5px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  display: inline-block;
  max-width: 100%;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* ç©ºçŠ¶æ€ */
.empty-state {
  text-align: center;
  padding: 100px 20px;
  color: rgba(255, 255, 255, 0.8);
  background: transparent;
  border-radius: 24px;
  position: relative;
  overflow: hidden;
  z-index: 1;
}

.empty-state::before {
  content: '';
  position: absolute;
  inset: 0;
  z-index: -1;
  backdrop-filter: blur(10px) saturate(150%);
  -webkit-backdrop-filter: blur(10px) saturate(150%);
  background: rgba(255, 255, 255, 0.1);
  border-radius: inherit;
  border: 1px solid rgba(255, 255, 255, 0.2);
}

.empty-icon {
  font-size: 4rem;
  margin-bottom: 20px;
  opacity: 0.9;
  filter: drop-shadow(0 4px 10px rgba(255, 182, 193, 0.3));
}

.empty-state p {
  font-size: 1.1rem;
  margin-bottom: 10px;
}

.empty-sub {
  font-size: 0.9rem;
  color: rgba(255, 255, 255, 0.7);
}

.empty-sub a {
  color: #ffb6c1;
  text-decoration: none;
  font-weight: 600;
  padding: 2px 8px;
  border-radius: 12px;
  background: rgba(255, 182, 193, 0.2);
  transition: all 0.3s ease;
}

.empty-sub a:hover {
  background: rgba(255, 182, 193, 0.3);
  color: white;
}

/* ç§»åŠ¨ç«¯é€‚é… */
@media (max-width: 768px) {
  .social-page { padding-bottom: 70px; }

  .conv-item { padding: 12px 14px; }

  .conv-avatar-wrap,
  .conv-avatar { width: 48px; height: 48px; }

  .conv-avatar span { font-size: 1.1rem; }
  .conv-name { font-size: 0.95rem; }
  .conv-time { font-size: 0.7rem; padding: 2px 6px; }
  .conv-preview { font-size: 0.8rem; }
  .conv-preview span { padding: 2px 8px; }
}

@media (max-width: 480px) {
  .conv-item { padding: 10px 12px; gap: 10px; }

  .conv-avatar-wrap,
  .conv-avatar { width: 44px; height: 44px; }

  .conv-badge { font-size: 0.65rem; padding: 2px 6px; min-width: 18px; }

  .empty-state { padding: 80px 15px; }
  .empty-icon { font-size: 3.5rem; }
  .empty-state p { font-size: 1rem; }
}

/* é™çº§å¤„ç† */
@supports not (backdrop-filter: blur(10px)) {
  .conv-item::before { background: rgba(255, 255, 255, 0.4); }
  .empty-state::before { background: rgba(255, 255, 255, 0.3); }
}

/* è¿›åœºåŠ¨ç”» */
@keyframes fadeInUp {
  from { opacity: 0; transform: translateY(10px); }
  to   { opacity: 1; transform: translateY(0); }
}

.conv-item { animation: fadeInUp 0.4s ease forwards; }
.conv-item:nth-child(1)  { animation-delay: 0.05s; }
.conv-item:nth-child(2)  { animation-delay: 0.1s; }
.conv-item:nth-child(3)  { animation-delay: 0.15s; }
.conv-item:nth-child(4)  { animation-delay: 0.2s; }
.conv-item:nth-child(5)  { animation-delay: 0.25s; }
.conv-item:nth-child(6)  { animation-delay: 0.3s; }
.conv-item:nth-child(7)  { animation-delay: 0.35s; }
.conv-item:nth-child(8)  { animation-delay: 0.4s; }
.conv-item:nth-child(9)  { animation-delay: 0.45s; }
.conv-item:nth-child(10) { animation-delay: 0.5s; }
</style>
{% endblock %}